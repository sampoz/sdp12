<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:icecore="http://www.icefaces.org/icefaces/core"
	xmlns:ace="http://www.icefaces.org/icefaces/components"
	xmlns:ice="http://www.icesoft.com/icefaces/component">
<h:head>
	<title>Titanium UI</title>
	<ice:outputStyle href="./xmlhttp/css/rime/rime.css" />
</h:head>
<h:body>
	<h:form>
		<style type="text/css">
.ui-datatable-odd {
	background-color: lightgray !important;
}

.left label {
	display:block;
	float:left;
	margin-left:10px;
}

.left input {
	display:block;
	float:left;
	margin-left:10px;
}

.left select {
	display:block;
	float:left;
	margin-left:10px;
}

.red {
	color: red;
	float: left;
	text-align: left;
	margin-top: 10px;
	margin-bottom: 10px;
}

.activated {
	color: green;
	font-weight: bolder;
}

.deactivated {
	color: grey;
	font-weight: bolder;
}

.removed {
	color: red;
	font-weight: bolder;
}

.grey {
	color: grey;
}

.instanceleft {
	float: left;
	margin-left: 10px;
	margin-right: 10px;
}
.tabbutton {
	float: right;
}
</style>

		
		<ace:tabSet id="sampleTabSet" clientSide="false"
				selectedIndex="#{schedulingDataManager.selectedTabIndex}" binding="#{schedulingDataManager.tabSet}">

			<ace:tabPane id="login_tab" label="Login"
				rendered="#{sessionBean.user.authenticated eq false}">
				<h:panelGrid id="login_grid" columns="2"
					styleClass="centeredPanelWithBorderSpacingAndLeftJustifiedText">
					<h:outputLabel id="username_label" for="username_input"
						value="Username: " />
					<h:inputText id="username_input" value="#{loginManager.username}" />
					<h:outputLabel id="password_label" for="password_input"
						value="Password: " />
					<h:inputSecret id="password_input" value="#{loginManager.password}" />
					<ice:commandButton id="login_button" value="Login"
						action="#{loginManager.authenticate}" />

					<ace:submitMonitor for="login_button" activeLabel="Logging in"
						autoCenter="true" blockUI="@source" />
				</h:panelGrid>
			</ace:tabPane>
			<ace:tabPane id="schedulings" label="Schedulings"
				rendered="#{sessionBean.user.authenticated}">

				<h:panelGrid columns="2">
					<ace:menuBar>
						<ace:menuItem id="select_filtered" value="Select Filtered"
							actionListener="#{schedulingDataManager.selectFiltered}"
							icon="ui-icon ui-icon-check"
							rendered="#{sessionBean.user.runRights}">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
						<ace:menuItem id="deselect_all" value="Deselect All"
							actionListener="#{schedulingDataManager.deselectAll}"
							icon="ui-icon ui-icon-closethick"
							rendered="#{sessionBean.user.runRights}">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
						<ace:menuItem id="run_selected" value="Run Selected"
							onclick="run_conf.show()"
							icon="ui-icon ui-icon-play"
							rendered="#{sessionBean.user.runRights}"
							actionListener="#{schedulingDataManager.listSelected}">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
						
						<ace:menuItem id="resume_selected" value="Resume Selected"
							actionListener="#{schedulingDataManager.resumeSelected}"
							icon="ui-icon ui-icon-circle-triangle-e"
							rendered="#{sessionBean.user.editRights}">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
						<ace:menuItem id="hold_selected" value="Hold Selected"
							actionListener="#{schedulingDataManager.holdSelected}"
							icon="ui-icon ui-icon-circle-close"
							rendered="#{sessionBean.user.editRights}">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
						
						<ace:menuItem id="refresh" value="Refresh"
							actionListener="#{schedulingDataManager.refresh}"
							icon="ui-icon ui-icon-refresh">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
						
						
					</ace:menuBar>
					<a href="https://google.com"> <img
						src="resources/images/question.png"
						style="width: 24px; height: 24px;" />
					</a>
				</h:panelGrid>
				
				<ace:confirmationDialog id="run_confirmation" widgetVar="run_conf" 
				message="Are you sure you want to run following schedulings?" 
				header="Confirm Run" 
				width="330" 
				height="220">
							<ice:outputText value="#{schedulingDataManager.schedulingList}" escape="false"/>
						<h:panelGrid columns="2">
		                    <h:commandButton id="yes" value="Yes" onclick="run_conf.hide()" actionListener="#{schedulingDataManager.runSelectedSchedules}" />
		                    <h:commandButton id="no" value="No" onclick="run_conf.hide()"/>
               			 </h:panelGrid>
				</ace:confirmationDialog>
				
				<ice:panelPopup visible="#{schedulingDataManager.responseDialogVisible}"
                            rendered="#{schedulingDataManager.responseDialogVisible}"
                            modal="true"
                            autoCentre="true">
                  <f:facet name="header">
                    <h:panelGroup>
                        <h:outputText value="Run Report" style="margin-left:5px"/>
                    </h:panelGroup>
                </f:facet>
                <f:facet name="body">
                    <pre>
                   		 <h:outputText value="#{schedulingDataManager.runReport}"></h:outputText>
                    </pre>
                    <br/>
                    <h:panelGroup>
                            <h:commandButton value="Close" actionListener="#{schedulingDataManager.setResponseDialogVisible(false)}" style="margin-left: auto; margin-right: auto;"/>
               		 </h:panelGroup>
                </f:facet>
                
                </ice:panelPopup>
				
				<ace:submitMonitor for="refresh" activeLabel="Refreshing"
					autoCenter="true" blockUI="@source" />

				<ace:accordion id="accordion" collapsible="true" autoHeight="false"
					activeIndex="1" rendered="#{sessionBean.user.addRights}">
					<ace:accordionPane id="addScheduling" title="Add Scheduling">

						<h:panelGrid id="addGrid" columns="6">
							<h:outputLabel id="nameLabel" for="nameInput" value="Name: " />
							<h:inputText id="nameInput"
								value="#{schedulingDataManager.builder.name}" />
							<h:outputLabel id="descLabel" for="descInput"
								value="Description: " />
							<h:inputText id="descInput"
								value="#{schedulingDataManager.builder.description}" />
							<h:outputLabel id="cronLabel" for="cronInput" value="CRON: " />
							<h:inputText id="cronInput"
								value="#{schedulingDataManager.builder.cron}" />
							<h:outputLabel id="sourceLabel" for="sourceInput"
								value="Source: " />
							<h:selectOneMenu id="sourceInput"
								value="#{schedulingDataManager.builder.source}">
								<f:selectItems value="#{schedulingDataManager.backends}" />
								<f:converter converterId="entityConverter" />
							</h:selectOneMenu>
							<h:outputLabel id="targetLabel" for="targetInput"
								value="Target: " />
							<h:selectOneMenu id="targetInput"
								value="#{schedulingDataManager.builder.target}">
								<f:selectItems value="#{schedulingDataManager.backends}" />
								<f:converter converterId="entityConverter" />
							</h:selectOneMenu>
							<h:outputLabel id="modeLabel" for="modeInput" value="Mode: " />
							<h:selectOneMenu id="modeInput"
								value="#{schedulingDataManager.builder.mode}">
								<f:selectItems value="#{schedulingDataManager.modes}" />
								<f:converter converterId="entityConverter" />
							</h:selectOneMenu>
							<h:outputLabel id="bankLabel" for="bankInput" value="Holiday: " />
							<h:selectBooleanCheckbox id="bankInput"
								value="#{schedulingDataManager.builder.bankHolidayOnly}" />

							<h:outputLabel id="javaLabel" for="javaInput" value="Pollable: " />
							<h:selectBooleanCheckbox id="javaInput"
								value="#{schedulingDataManager.builder.javaAgentPollable}"
								disabled="#{schedulingDataManager.builder.composite.javaAgentPollable eq 0}" />
						</h:panelGrid>
						<h:panelGrid columns="2">
						<h:outputLabel id="compositeLabel" for="compositeInput"
								value="Composite: " />
							<ice:selectOneMenu id="compositeInput"
								value="#{schedulingDataManager.builder.composite}"
								partialSubmit="true">
								<f:selectItems value="#{schedulingDataManager.composites}" />
								<f:converter converterId="entityConverter" />
							</ice:selectOneMenu>
						</h:panelGrid>
						<h:panelGrid columns="3">
						<h:outputLabel id="add_comment_label" for="add_comment_input"
								value="Comment: " />
								<h:inputText id="add_comment_input"
								value="#{schedulingDataManager.addComment.text}" />
								<h:outputLabel id="opt_comment_label" for="add_comment_input"
								value="(Opt.)" />
						</h:panelGrid>
						<ice:commandButton id="add_scheduling" value="Add Scheduling"
							actionListener="#{schedulingDataManager.addScheduling}" />
						<pre>
							<ice:outputText value="#{schedulingDataManager.addErrorMessage}"
								rendered="#{schedulingDataManager.showAddError}"
								styleClass="red" />
						</pre>
						<ace:submitMonitor for="add_scheduling" activeLabel="Adding"
							autoCenter="true" blockUI="@source" />

					</ace:accordionPane>
				</ace:accordion>

				<ace:dataTable id="scheduleTable"
					value="#{schedulingDataManager.schedulings}" var="schedule"
					paginator="true" paginatorPosition="bottom" rows="10"
					stateMap="#{schedulingDataManager.stateMap}"
					selectionMode="multiple" resizableColumns="true"
					binding="#{schedulingDataManager.dataTable}">
					<ace:ajax event="select" execute="@this" />
					<ace:column id="edit" headerText="Edit">
						<ace:expansionToggler
							changeListener="#{schedulingDataManager.expansion}" />
					</ace:column>


					<ace:column id="name" headerText="Name" sortBy="#{schedule.name}"
						filterBy="#{schedule.name}" filterMatchMode="contains">


						<h:panelGrid>
							<h:outputText id="nameCell" value="#{schedule.name}"
								styleClass="tooltipTargetStyle" />
						</h:panelGrid>
						<ace:tooltip id="tooltip_name_column" for="nameCell"
							value="#{schedule.name}" showDelay="500" hideDelay="200">
						</ace:tooltip>
					</ace:column>


					<ace:column id="mode" headerText="Mode"
						sortBy="#{schedule.modeLabel}" filterBy="#{schedule.modeLabel}"
						filterMatchMode="exact">
						<ice:panelGroup style="width:100px;">
							<f:facet name="mode">
							Mode
							</f:facet>
						</ice:panelGroup>
						<h:outputText id="modeCell" value="#{schedule.modeLabel}" styleClass="#{schedule.styleClass}"/>

					</ace:column>

					<ace:column id="time" headerText="Time" sortBy="#{schedule.cron}"
						filterBy="#{schedule.cron}" filterMatchMode="contains">
						<h:outputText id="timeCell" value="#{schedule.cron}" />
					</ace:column>
					<ace:column id="cron_variables" headerText="Vars">
						<h:panelGrid id="icon_grid" columns="2">
							<h:graphicImage id="java_image" library="images"
								name="javaicon.png" style="height: 30px; width: 30px; "
								rendered="#{schedule.javaAgentPollable gt 0}" />
							<h:graphicImage id="bank_image" library="images"
								name="bankicon.jpg" style="height: 30px; width: 30px; "
								rendered="#{schedule.bankHolidayOnly gt 0}" />
						</h:panelGrid>
					</ace:column>

					<ace:column id="source" headerText="Source"
						sortBy="#{schedule.sourceName}" filterBy="#{schedule.sourceName}"
						filterMatchMode="contains">

						<h:outputText id="sourceCell" value="#{schedule.sourceName}" />
					</ace:column>

					<ace:column id="target" headerText="Target"
						sortBy="#{schedule.targetName}" filterBy="#{schedule.targetName}"
						filterMatchMode="contains">
						<h:outputText id="targetCell" value="#{schedule.targetName}"></h:outputText>


					</ace:column>

					<ace:column id="description" headerText="Description"
						sortBy="#{schedule.description}"
						filterBy="#{schedule.description}" filterMatchMode="contains">
						<ice:panelGroup style="width:100px;">
							<f:facet name="description">
							Description
						</f:facet>
						</ice:panelGroup>
						<h:outputText id="descCell" value="#{schedule.description}" />
					</ace:column>



					<ace:panelExpansion>
						<ace:panel id="edit_panel" header="Edit" >

							<ice:outputText value="#{schedulingDataManager.editErrorMessage}"
								rendered="#{schedulingDataManager.showEditError}"
								styleClass="red" />

							<h:panelGrid id="editGrid" columns="6"
								 styleClass="left">

								<h:outputLabel id="editNameLabel" for="editNameInput"
									value="Name: " />

								<h:inputText id="editNameInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).name}"
									disabled="#{not sessionBean.user.editRights}" styleClass="left"/>

								<h:outputLabel id="editDescLabel" for="editDescInput"
									value="Description: " />

								<h:inputText id="editDescInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).description}"
									disabled="#{not sessionBean.user.editRights}" styleClass="left"/>

								<h:outputLabel id="editCronLabel" for="editCronInput"
									value="CRON: " />

								<h:inputText id="editCronInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).cron}"
									disabled="#{not sessionBean.user.editRights}" styleClass="left"/>

								<h:outputLabel id="editSourceLabel" for="editSourceInput"
									value="Source: " />

								<h:selectOneMenu id="editSourceInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).source}"
									disabled="#{not sessionBean.user.editRights}">
									<f:selectItems value="#{schedulingDataManager.backends}" />
									<f:converter converterId="entityConverter" />
								</h:selectOneMenu>

								<h:outputLabel id="editTargetLabel" for="editTargetInput"
									value="Target: " />

								<h:selectOneMenu id="editTargetInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).target}"
									disabled="#{not sessionBean.user.editRights}">
									<f:selectItems value="#{schedulingDataManager.backends}" />
									<f:converter converterId="entityConverter" />
								</h:selectOneMenu>

								<h:outputLabel id="editModeLabel" for="editModeInput"
									value="Mode: " />

								<h:selectOneMenu id="editModeInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).mode}"
									disabled="#{not sessionBean.user.editRights}">
									<f:selectItems value="#{schedulingDataManager.modes}" />
									<f:converter converterId="entityConverter" />
								</h:selectOneMenu>


								<h:outputLabel id="editBankLabel" for="editBankInput"
									value="Holiday: " />

								<ice:selectBooleanCheckbox id="editBankInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).bankHolidayOnly}"
									partialSubmit="true"
									disabled="#{not sessionBean.user.editRights}" />

								<h:outputLabel id="editJavaLabel" for="editJavaInput"
									value="Pollable: " />

								<ice:selectBooleanCheckbox id="editJavaInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).javaAgentPollable}"
									partialSubmit="true"
									disabled="#{not sessionBean.user.editRights}" />
							
							</h:panelGrid>
							
							<h:panelGrid columns="2" styleClass="left">
							<h:outputLabel id="editCompositeLabel" for="editCompositeInput"
									value="Composite: " />
								<h:selectOneMenu id="editCompositeInput"
									value="#{schedulingDataManager.editBuffer.get(schedule.id).composite}"
									disabled="#{not sessionBean.user.editRights}">
									<f:selectItems value="#{schedulingDataManager.composites}" />
									<f:converter converterId="entityConverter" />
								</h:selectOneMenu>
							</h:panelGrid>


							<br />
							<ice:commandButton id="confirm_edit" value="Confirm"
								actionListener="#{schedulingDataManager.confirmEdit(schedule)}"
								rendered="#{sessionBean.user.editRights}" />

							<ice:commandButton id="reset_edit" value="Reset"
								actionListener="#{schedulingDataManager.resetEdit(schedule)}"
								rendered="#{sessionBean.user.editRights}" />
								
							<ice:commandButton id="open_in_new_tab_button" value="Open in new tab"
							image="resources/images/openinnewtabicon.jpg" 
							actionListener="#{schedulingDataManager.addTab(schedule)}"/>
							
							<ace:submitMonitor for="confirm_edit" />
							<ace:submitMonitor for="reset_edit" activeLabel="Resetting"
								autoCenter="true" blockUI="@source" />
						</ace:panel>
						<br/>
						<ace:dataTable id="comment_table"
							value="#{schedulingDataManager.commentLists.get(schedule.id)}"
							var="comment" paginator="false" rows="5"  emptyMessage="-- No Comments --">
							<ace:column id="creation_date" headerText="Date" >
							
								<ice:outputText value="#{comment.creationDate}" />
							</ace:column>
							<ace:column id="text" headerText="Text" >
								<h:outputText value="#{comment.text}" />	
							</ace:column>
						</ace:dataTable>
						<br/>
						<ace:textEntry id="edit_comment_input" label="Comment: " labelPosition="left"
							value="#{schedulingDataManager.editCommentList.get(schedule.id).text}"
							rendered="#{sessionBean.user.editRights}" style="margin-right: 10px;"/>
						<ice:commandButton id="sumbit_comment" value="Submit"
							actionListener="#{schedulingDataManager.submitComment(schedule.id)}"
							rendered="#{sessionBean.user.editRights}" />
					</ace:panelExpansion>
				</ace:dataTable>



			</ace:tabPane>

			<ace:tabPane id="instance_log" label="Instance Log"
				rendered="#{sessionBean.user.authenticated}">

				<h:panelGrid columns="2">
					<ace:menuBar>
						<ace:menuItem id="run_instances" value="Run selected instances"
							actionListener="#{dataMaster.runInstances}"
							icon="ui-icon ui-icon-gear">
							<ace:ajax event="activate" execute="@this" />
						</ace:menuItem>
					</ace:menuBar>
				</h:panelGrid>

				<ace:dataTable id="instanceTable" value="#{dataMaster.instances}"
					var="instance" paginator="true" paginatorPosition="both" rows="10"
					stateMap="#{dataMaster.i_stateMap}" selectionMode="multiple"
					resizableColumns="true" binding="#{dataMaster.i_dataTable}">
					<ace:ajax event="select" execute="@this" />


					<ace:column id="i_run_state" headerText="Was run"
						sortBy="#{instance.statusID}">
						<h:panelGrid id="i_run_state_Id" columns="1">
							<h:graphicImage id="correct_image" library="images"
								name="correcticon.png" style="height: 30px; width: 30px; "
								rendered="#{instance.statusID eq 1}" />
							<h:graphicImage id="skipped_image" library="images"
								name="skippedicon.png" style="height: 30px; width: 30px; "
								rendered="#{instance.statusID gt 1}" />
						</h:panelGrid>
						<ace:tooltip id="tooltip_skipped_image" for="skipped_image"
							value="This instance was not run. Expand view for more information"
							showDelay="100" hideDelay="200">
						</ace:tooltip>
						<ace:tooltip id="tooltip_correct_image" for="correct_image"
							value="This instance was run normally" showDelay="100"
							hideDelay="200">
						</ace:tooltip>
						<ace:expansionToggler
							changeListener="#{dataMaster.instanceExpansion}" />
					</ace:column>
					<ace:panelExpansion>
						<ace:panel styleClass="instanceleft">
							<h:panelGrid id="instanceGrid" columns="4">

								<h:outputLabel value="Error Message:" />
								<h:outputText id="i_message"
									value="#{dataMaster.instanceEditBuffer.get(instance.id).message}"
									styleClass="instanceleft" />

								<h:outputLabel value="Composite: " />
								<h:outputText id="i_composite"
									value="#{dataMaster.instanceEditBuffer.get(instance.id).process}"
									styleClass="instanceleft" />

								<h:outputLabel value="Input files:" />
								<h:outputText id="i_input_files"
									value="#{dataMaster.instanceEditBuffer.get(instance.id).inputFileName}"
									styleClass="instanceleft" />

								<h:outputLabel value="Output files:" />
								<h:outputText id="i_output_files"
									value="#{dataMaster.instanceEditBuffer.get(instance.id).outputFileName}"
									styleClass="instanceleft" />

							</h:panelGrid>
						</ace:panel>
					</ace:panelExpansion>
					<ace:column id="i_name" headerText="Name" sortBy="#{instance.name}"
						filterBy="#{instance.name}" filterMatchMode="contains">
						<h:outputText id="i_nameCell" value="#{instance.name}" />
					</ace:column>

					<ace:column id="i_statusID" headerText="StatusID"
						sortBy="#{instance.statusID}" filterBy="#{instance.statusID}"
						filterMatchMode="contains">
						<h:panelGrid>
							<h:outputText id="i_statusIDCell" value="#{instance.statusID}"
								styleClass="tooltipTargetStyle" />
						</h:panelGrid>
					</ace:column>

					<ace:column id="i_startDate" headerText="StartDate"
						sortBy="#{instance.startDate}" filterBy="#{instance.startDate}"
						filterMatchMode="contains">
						<h:outputText id="i_startDateCell" value="#{instance.startDate}" />
					</ace:column>

					<ace:column id="i_endDate" headerText="EndDate"
						sortBy="#{instance.endDate}" filterBy="#{instance.endDate}"
						filterMatchMode="contains">
						<h:outputText id="i_endDateCell" value="#{instance.endDate}" />
					</ace:column>

					<ace:column id="i_inputFileAmmount" headerText="InputFiles"
						sortBy="#{instance.inputFileAmmount}"
						filterBy="#{instance.inputFileAmmount}" filterMatchMode="contains">
						<h:outputText id="i_inputFileAmmountCell"
							value="#{instance.inputFileAmmount}" />
					</ace:column>

					<ace:column id="i_outputFileAmmount" headerText="OutputFiles"
						sortBy="#{instance.outputFileAmmount}"
						filterBy="#{instance.outputFileAmmount}"
						filterMatchMode="contains">
						<h:outputText id="i_outputFileAmmountCell"
							value="#{instance.outputFileAmmount}" />
					</ace:column>

				</ace:dataTable>

			</ace:tabPane>

			<ace:tabPane id="audit_log" label="Audit Log"
				rendered="#{sessionBean.user.authenticated}">

			</ace:tabPane>
			
			 <c:forEach id="cForEachId" items="#{schedulingDataManager.tabs}" var="tab">
                <ace:tabPane label="#{tab.name}" id="tab_#{tab.id}">
                    <f:subview id="sub_#{tab.id}">
                        <h:panelGroup id="pnlGrp">
                            <h3><h:outputText value="#{tab.name}"/></h3>
                            <h:outputText id="spn" value="#{tab.name}"/>
                          		<ice:commandButton id="close_tab_button" value="Close tab"
							actionListener="#{schedulingDataManager.removeCurrent(schedulingDataManager.selectedTabIndex)}"/>
                        </h:panelGroup>
                    </f:subview>
                </ace:tabPane>
            </c:forEach>

		</ace:tabSet>

	</h:form>

</h:body>
</html>